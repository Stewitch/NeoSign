{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans '活动管理' %} - {{ block.super }}{% endblock %}
{% block content %}
<h3 class="mb-4">{% trans '活动管理' %}</h3>
<div class="d-flex justify-content-between align-items-center mb-3">
    <a class="btn btn-primary" href="{% url 'management:activity_create' %}">{% trans '新建活动' %}</a>
    <small class="text-muted">{% trans '管理参与人员、时间、状态。' %}</small>
</div>
<div class="table-responsive">
    <table class="table table-striped align-middle table-hover">
        <thead>
            <tr>
                <th>{% trans '名称' %}</th>
                <th>{% trans '时间' %}</th>
                <th>{% trans '状态' %}</th>
                <th>{% trans '创建人' %}</th>
                <th class="text-end">{% trans '操作' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in page_obj %}
            <tr>
                <td>{{ activity.name }}</td>
                <td>{{ activity.start_time }} - {{ activity.end_time }}</td>
                <td>{% if activity.is_ongoing %}<span class="badge bg-success">{% trans '进行中' %}</span>{% else %}<span class="badge bg-secondary">{% trans '已结束' %}</span>{% endif %}</td>
                <td>{{ activity.created_by.first_name|default:activity.created_by.student_id }}</td>
                <td class="text-end">
                    <a class="btn btn-sm btn-outline-primary" href="{% url 'management:activity_edit' activity.id %}">{% trans '编辑' %}</a>
                    <a class="btn btn-sm btn-outline-secondary" href="{% url 'management:activity_stats' activity.id %}">{% trans '签到统计' %}</a>
                    {% if activity.is_ongoing %}
                    <form class="d-inline" method="post" action="{% url 'management:activity_close' activity.id %}" data-confirm="{% trans '确认提前结束该活动？' %}" data-confirm-title="{% trans '结束活动' %}">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit">{% trans '提前结束' %}</button>
                    </form>
                    {% endif %}
                    <form class="d-inline" method="post" action="{% url 'management:activity_delete' activity.id %}" data-confirm="{% trans '确认删除该活动？删除后将无法恢复。' %}" data-confirm-title="{% trans '删除活动' %}">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit">{% trans '删除' %}</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center text-muted">{% trans '暂无活动' %}</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<nav aria-label="活动分页">
    <ul class="pagination">
        {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">{% trans '上一页' %}</a></li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">{% trans '上一页' %}</span></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">{% blocktrans with current=page_obj.number total=page_obj.paginator.num_pages %}第 {{ current }} / {{ total }} 页{% endblocktrans %}</span></li>
        {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans '下一页' %}</a></li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">{% trans '下一页' %}</span></li>
        {% endif %}
    </ul>
</nav>
{% endblock %}
